.#daily

## 今日取り組んだタスク

- [ ] ローカル環境で基本的なCRUDの実装
- [ ] スッキリわかるSQL入門４

---
---
## 一言

中間試験：Railsを取り組む前に、
一旦、今まで学習した内容（主にRails基礎）をアウトプットするため
ローカル環境で、遊んでましたw

一番基礎的なCRUDですらちょっと怪しかったので、日々アプリ開発に時間を割いていればよかったと後悔した
1日でした....

中間試験は取り組みつつも、ちょっとの間、そっちの方にも時間を割いていこうと思います😄
中間試験の課題に関連している機能はちょっと実装したい_:(´ཀ`」 ∠):


---
---
## 学習内容
### Ruby / Rails

---
#### なぜ同じクラスなのにedit、update、destroyなどには毎回@postが定義されているのか？


```ruby
class PostsController < ApplicationController
  def index
    @posts = Post.all
  end

  def new
    @post = Post.new
  end

  def create
    @post = Post.new(post_params)

    # DBに保存されたら、投稿一覧ページに飛ぶ
    if @post.save
      redirect_to posts_path
    else
      # 失敗したら、新規投稿ページに飛ぶ
      render :new
    end
  end

  def edit
    # どの掲示板の投稿を編集するのか指定
    @post = Post.find(params[:id])
  end

  def update
    @post = Post.find(params[:id])

    # タイトルとコンテントを含んだパラメータで更新された場合
    if @post.update(post_params)
      redirect_to posts_path
    else
      render :edit
    end
  end

  def destroy
    @post = Post.find(params[:id])
    @post.destroy
    redirect_to posts_path
  end

  private

  def post_params
    params.require(:post).permit(:title, :content)
  end
end

```

説明：
Railsのコントローラは、**HTTPリクエストごとに独立した新しいインスタンスが生成**されます！
つまり、`index` アクションが呼ばれたときの `@post` と、`edit` アクションが呼ばれたときの `@post` は
**まったく別のリクエスト・別のインスタンス変数**になります！

なぜ、こんなことをしているのかと言うと
あるリクエストの状態が別のリクエストに影響を与えることを防ぎ、安全性を保つために設計されています！

補足
ただし、`@post = Post.find(params[:id])` を何度も書くのはDRYに反してしまうので
**`before_action`** という仕組みを利用し、リファクタリングします！

```ruby
class PostsController < ApplicationController
  before_action :set_post, only: [:edit, :update, :destroy]

  def index
    @posts = Post.all
  end

  def new
    @post = Post.new
  end

  def create
    @post = Post.new(post_params)
    if @post.save
      redirect_to posts_path
    else
      render :new
    end
  end

  def edit
    # @post は before_action で定義済み
  end

  def update
    if @post.update(post_params)
      redirect_to posts_path
    else
      render :edit
    end
  end

  def destroy
    @post.destroy
    redirect_to posts_path
  end

  private

  def set_post
    @post = Post.find(params[:id])
  end

  def post_params
    params.require(:post).permit(:title, :content)
  end
end

```

#### 参考になったサイト
https://zenn.dev/eliri/articles/5f96710423fb7d

---

#### 投稿ページを削除しようとしても、削除できない問題

原因：
ログを確認したところ、削除時に`GET`メソッドのままであった

対策：
- `rails routes | grep posts`コマンド使って、正しくルーティングが記述されている確認
- ログを確認して、GETのままか、DELETEなのか確認
- 今回は、GETのままだったので、ビュー側で`method:` の指定されている確認して、解決

---
### SQL

##### UNION

説明：
今年の分のテーブルと去年の分のテーブルを合わせて、すべての期間のデータを「ひとつの表」として扱いたいときに
利用できる集合演算子のことです！

基本形：
```sql
SELECT 文１
UNION (ALL)
SELECT 文２

/*ALLにした場合、重複行は1つにまとめずに、そのまま返す*/
/*単独で使う場合、重複行を1行にまとめて返す*/
```

例：費目、入金額、出金額で和集合を取得する（順番は、入金額＞出金額＞費目）

家計簿テーブル
[![Image from Gyazo](https://i.gyazo.com/1f849c602d40ada536445f719b2d9cc6.png)](https://gyazo.com/1f849c602d40ada536445f719b2d9cc6)
家計簿アーカイブテーブル
[![Image from Gyazo](https://i.gyazo.com/93ace3419b96325a60bd8bb745568d72.png)](https://gyazo.com/93ace3419b96325a60bd8bb745568d72)

```sql
SELECT 費目, 入金額, 出金額 FROM 家計簿
UNION
SELECT 費目, 入金額, 出金額 FROM 家計簿アーカイブ
ORDER BY 2, 3, 1
```

出力：
```sql
|費目|入金額|出金額 |

|食費|0|380|
|教養娯楽費|0|1800|
|教養娯楽費|0|2800|
|水道光熱費|0|4200|
|交際費|0|5000|
|食費|0|5000|
|水道光熱費|0|7560|
|居住費|0|80000|
|給料|280000|0|

```


#### 参考になった書籍

- スッキリわかるSQL入門４

---
---
## エラーと対応

- エラー内容：
    
- 対処方法：


---
---
## 学んだこと

- `method: :delete`について
- 集合演算子UNIONについて
- 基本的なCRUDについて


---
---
## 教材

- スッキリわかるSQL入門４
- https://zenn.dev/eliri/articles/5f96710423fb7d


---
---
##### ⏳ 学習時間: 3.3時間 (また計測し忘れてました) 
##### 🌱 コミット数: １コミット