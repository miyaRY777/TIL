
# Hobby Matchingã€€é–¢é€£ä»˜ã‘

---

# â‘  users â‡„ profiles

### ğŸ”— é–¢ä¿‚

```
users.id  â† profiles.user_id
```

### ğŸ§  é–¢ä¿‚ã®ç¨®é¡

**1å¯¾1**

- 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
    
- 1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯1ãƒ¦ãƒ¼ã‚¶ãƒ¼
    

### Railsã§æ›¸ãã¨

```ruby
# User
has_one :profile

# Profile
belongs_to :user
```

### DBå´ã®ãƒã‚¤ãƒ³ãƒˆ

- `profiles.user_id` ãŒå¤–éƒ¨ã‚­ãƒ¼
    
- æœ¬æ¥ã¯ `unique index` ã‚’ä»˜ã‘ã‚‹ã¨ã‚ˆã‚Šå®‰å…¨ï¼ˆ1å¯¾1ä¿è¨¼ï¼‰
    

---

# â‘¡ profiles â‡„ hobbiesï¼ˆå¤šå¯¾å¤šï¼‰

### ğŸ”— å®Ÿéš›ã¯ã“ã†

```
profiles.id â† profile_hobbies.profile_id
hobbies.id  â† profile_hobbies.hobby_id
```

### ğŸ§  é–¢ä¿‚ã®ç¨®é¡

**å¤šå¯¾å¤šï¼ˆN:Nï¼‰**

- 1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯è¤‡æ•°è¶£å‘³ã‚’æŒã¦ã‚‹
    
- 1è¶£å‘³ã¯è¤‡æ•°ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«ç´ã¥ã
    

### ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

```
profile_hobbies
```

### Rails

```ruby
# Profile
has_many :profile_hobbies
has_many :hobbies, through: :profile_hobbies

# Hobby
has_many :profile_hobbies
has_many :profiles, through: :profile_hobbies
```

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

```
UNIQUE(profile_id, hobby_id)
```

ã“ã‚ŒãŒã‚ã‚‹ã¨ï¼š

âœ” åŒã˜è¶£å‘³ã‚’2å›ç™»éŒ²ã§ããªã„  
âœ” ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãŒé«˜ã„

---

# â‘¢ profiles â‡„ roomsï¼ˆå¤šå¯¾å¤šï¼‰

ã“ã‚Œã¯ã€Œéƒ¨å±‹å‚åŠ ã€ã§ã™ã€‚

### ğŸ”— å®Ÿéš›ã®æ§‹é€ 

```
profiles.id â† room_memberships.profile_id
rooms.id    â† room_memberships.room_id
```

### ğŸ§  é–¢ä¿‚ã®ç¨®é¡

**å¤šå¯¾å¤šï¼ˆN:Nï¼‰**
- 1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯è¤‡æ•°ã®éƒ¨å±‹ã«å‚åŠ ã§ãã‚‹
- 1éƒ¨å±‹ã«ã¯è¤‡æ•°ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒå‚åŠ ã§ãã‚‹

### ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«

```
room_memberships
```

### Rails

```ruby
# Profile
has_many :room_memberships
has_many :rooms, through: :room_memberships

# Room
has_many :room_memberships
has_many :profiles, through: :room_memberships
```

### ğŸ’¡ created_atãŒé‡è¦

`room_memberships.created_at` ã‚’ä½¿ãˆã°ï¼š

âœ” JOINé †ã§ä¸¦ã¹ã‚‰ã‚Œã‚‹  
âœ” ç™ºè¡Œè€…ã‚’æœ€åˆã«è¡¨ç¤ºã§ãã‚‹

---

# â‘£ rooms â‡„ share_links

### ğŸ”— é–¢ä¿‚

```
rooms.id â† share_links.room_id
```

### ğŸ§  é–¢ä¿‚ã®ç¨®é¡

**1å¯¾å¤š**

- 1éƒ¨å±‹ã¯è¤‡æ•°ã®å…±æœ‰ãƒªãƒ³ã‚¯ã‚’æŒã¦ã‚‹
    
- 1å…±æœ‰ãƒªãƒ³ã‚¯ã¯1éƒ¨å±‹ã«å±ã™ã‚‹
    

### Rails

```ruby
# Room
has_many :share_links

# ShareLink
belongs_to :room
```

---

# â‘¤ rooms â‡„ issuer_profile

ã“ã“ãŒè¨­è¨ˆçš„ã«è‰¯ã„ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

### ğŸ”— é–¢ä¿‚

```
rooms.issuer_profile_id â†’ profiles.id
```

### ğŸ§  é–¢ä¿‚ã®ç¨®é¡

**1å¯¾å¤šï¼ˆç™ºè¡Œè€…ï¼‰**
- 1ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯è¤‡æ•°éƒ¨å±‹ã‚’ä½œã‚Œã‚‹
- 1éƒ¨å±‹ã«ã¯ç™ºè¡Œè€…ãŒ1äººã„ã‚‹

### Rails

```ruby
# Room
belongs_to :issuer_profile, class_name: "Profile"

# Profile
has_many :issued_rooms,
         class_name: "Room",
         foreign_key: :issuer_profile_id
```

---

# ğŸ§  å…¨ä½“ã‚’ã¾ã¨ã‚ã‚‹ã¨

|é–¢ä¿‚|ç¨®é¡|ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«|
|---|---|---|
|User - Profile|1:1|ãªã—|
|Profile - Hobby|N:N|profile_hobbies|
|Profile - Room|N:N|room_memberships|
|Room - ShareLink|1:N|ãªã—|
|Profile - Room(ç™ºè¡Œè€…)|1:N|ãªã—|

---

# ğŸ”¥ è¨­è¨ˆãƒ¬ãƒ™ãƒ«ã§è‰¯ã„ç‚¹

âœ” å¤šå¯¾å¤šã¯å¿…ãšä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã§æ­£è¦åŒ–  
âœ” JOINé †ã‚’membershipã§ç®¡ç†  
âœ” ShareLinkã¯Roomã«å¾“å±ï¼ˆæ­£ã—ã„è²¬å‹™åˆ†é›¢ï¼‰  
âœ” issuerã‚’Userã§ã¯ãªãProfileã«ã—ã¦ã„ã‚‹ï¼ˆå…¬é–‹ä¸»ä½“ã«åˆã‚ã›ã¦ã„ã‚‹ï¼‰

ã“ã‚Œã¯è¨­è¨ˆã¨ã—ã¦ã‹ãªã‚Šè‰¯ã„ã§ã™ã€‚

---

ã‚‚ã—ã‚ˆã‘ã‚Œã°æ¬¡ï¼š

- â“ Roomå‰Šé™¤æ™‚ã®dependentè¨­è¨ˆã©ã†ã™ã‚‹ï¼Ÿ
    
- â“ å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã¯DBãƒ¬ãƒ™ãƒ«ã§å¼µã‚‹ï¼Ÿ
    
- â“ N+1å•é¡Œã¯ã©ã“ã§èµ·ãã‚‹ï¼Ÿ
    

ã©ã“ã¾ã§æ·±æ˜ã‚Šã¾ã™ã‹ï¼Ÿ ğŸ˜