## テーマ

`t.references :issuer_profile, foreign_key: { to_table: :profiles }` の意味

---

## 結論

この記述は、**roomsテーブルに issuer_profile_id を作り、その値を profiles.id に関連付けるための設定**です。  
外部キーは「参照元のテーブル」に作られます。

---

## 理由

`references` は「別のテーブルのIDを持つカラム」を作る命令です。  
今回の場合は `rooms` に `issuer_profile_id` が作られます。

しかし `issuer_profile` という名前から Rails は本来 `issuer_profiles` テーブルを探します。  
実際に存在するのは `profiles` テーブルです。

そのため

```ruby
foreign_key: { to_table: :profiles }
```

と書いて、「参照先は profiles テーブルですよ」と明示しています。

つまり、

- 追加されるのは `profiles` ではない
    
- 追加されるのは `rooms` 側
    
- 参照先は `profiles.id`
    

という構造になります。

---

## 具体例

```ruby
t.references :issuer_profile,
             null: false,
             foreign_key: { to_table: :profiles }
```

これで作られるのは：

```
rooms テーブル
issuer_profile_id（整数）
```

そしてDBのルールとして：

```
rooms.issuer_profile_id は
profiles.id に存在する値しか入れられない
```

という制約がつきます。

図にすると：

```
profiles
id: 1

rooms
issuer_profile_id: 1
```

→ rooms が profiles を参照している状態です。

---

## 結論

`references` は「参照される側」にカラムを作るのではなく、**参照する側にIDカラムを作る仕組み**です。  
今回のコードは、rooms が profiles を安全に参照できるようにするための設定です。