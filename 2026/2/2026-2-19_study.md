# reflect_on_association とは？

## 結論（Point）

`reflect_on_association` は、**モデルに書いてある「関連（belongs_to / has_many / has_one など）」を調べるためのメソッド**です。  
DBに保存しなくても、**「関連が定義されているか」「種類は何か」**を確認できます。

---

## 理由（Reason）

関連はアプリの設計の土台です。  
でも、関連は「コードに書いたつもり」でも、リファクタや書き換えで壊れやすいです。  
`reflect_on_association` を使うと、**モデルの宣言（設計）が正しいかをテストで守れる**ので安心です。

---

## 具体例（Example）

Roomモデルに、発行者プロフィールとの関連があるかを確認します。

```rb
assoc = Room.reflect_on_association(:issuer_profile)
assoc.macro
# => :belongs_to
```

RSpecではこう書けます。

```rb
it "issuer_profile is belongs_to" do
  assoc = Room.reflect_on_association(:issuer_profile)
  expect(assoc.macro).to eq(:belongs_to)
end
```

これで、`belongs_to :issuer_profile` を消したり間違えたら、テストが落ちます。

---

## 結論（Point 再掲）

`reflect_on_association` は、**モデルの関連を「のぞき見して確認する」ための道具**です。  
関連の設計を守りたいときに、テストで使うと効果的です。