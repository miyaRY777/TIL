#daily

## 今日取り組んだタスク

- [ ] Rails応用１
- [ ] スッキリわかるSQL入門7章

---
---
## 一言





---
---
## 学習内容

### SQL

##### 単一行副問い合わせ

説明：
検索結果が1行1列の1つの値となる副問い合わせを指しています！
また、これを記述できるのは
SELECT文の選択列リストやFROM句、UPDATE文のSET句、1つの値との判定を行うWHERE句の条件式です！

##### ↪︎SET句で利用する

説明：
SET句で利用すれば、集計と更新をいっぺんにできちゃいます！

具体例：SET句で副問い合わせを利用する

家計簿テーブル
![[スクリーンショット 2025-11-14 23.16.37.png]]
![[スクリーンショット 2025-11-14 23.17.18.png]]

家計簿集計テーブル
![[スクリーンショット 2025-11-14 23.18.20.png]]

SQL：
```sql
UPDATE 家計簿集計
SET 平均 = (SELECT AVG(出金額)
　　　　　　　　FROM 家計簿
　　　　　　　 WHERE 出金額 > 0
　　　　　　　   AND 費目 = '食費')
WHERE 費目 = '食費'
```

出力：
![[スクリーンショット 2025-11-14 23.29.31.png]]


##### ↪︎選択列リストで利用する


具体例：選択リストで副問い合わせを利用する

家計簿テーブル
![[スクリーンショット 2025-11-14 23.16.37.png]]
![[スクリーンショット 2025-11-14 23.17.18.png]]


家計簿集計テーブル
![[スクリーンショット 2025-11-14 23.36.12.png]]

SQL：
```sql
SELECT 日付, メモ, 出金額,
       (SELECT 合計 FROM 家計簿集計
         WHERE 費目 = '食費') AS 過去の合計額 ←10380の値を取得
  FROM 家計簿アーカイブ
 WHERE 費目 = '食費'
```

出力：
```sql
|日付|メモ|出金額|過去の合計額|

|2023-12-24|レストランみやび|5000|10380|
|2024-01-13|新年会|5000|10380|
```

補足１
このSQL文の副問い合わせは、家計簿集計テーブルの食費に関する合計金額を取得する内容です！

補足２
1行1列の値を取得する、この意識が重要です！


##### 複数行副問い合わせ

説明：
これは、検索結果がn行1列の複数の値となることを指しています！
また、複数の値との判定を行うWHERE句の条件式や、SELECT文のFROM句に記述できます！

##### ↪︎IN演算子で利用する

具体例：INを使った条件式

家計簿集計テーブル
![[スクリーンショット 2025-11-15 0.51.32.png]]

SQL：
```sql
SELECT * FROM 家計簿集計
　WHERE 費目 IN ('食費', '水道光熱費', '教養娯楽費', '給料')
```

出力：
```sql
|費目|合計|平均|最大|最小|回数|

|水道光熱費|11760|5880|7560|4200|2|
|食費|10380|3460|5000|380|3|
|教養娯楽費|4600|2300|2800|1800|2|
|給料|840000|280000|280000|280000|3|
```

補足
IN演算子は、ある**値が指定した複数の候補の中にあれば、 true** を返す演算子である


具体例：INで副問い合わせを利用する

![[スクリーンショット 2025-11-15 2.33.01.png]]

SQL：
```sql
SELECT * FROM 家計簿集計
 WHERE 費目 IN (SELECT DISTINCT 費目 FROM 家計簿)
```

出力：
```sql
|費目|合計|平均|最大|最小|回数|

|水道光熱費|11760|5880|7560|4200|2|
|食費|10380|3460|5000|380|3|
|教養娯楽費|4600|2300|2800|1800|2|
|給料|840000|280000|280000|280000|3|
```


---
---
## 学んだこと

- 単一行副問い合わせについて
	- SET句で利用するケース
	- ︎選択列リストで利用するケース
- 複数行副問い合わせ
	- IN演算子で利用するケース
	- 他にもANY/ALLを利用するケースがある


---
---
## 教材

- スッキリわかるSQL入門


---
---
##### ⏳ 学習時間: ５時間  
##### 🌱 コミット数: １コミット