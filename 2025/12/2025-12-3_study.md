#daily

## 今日取り組んだタスク

- [ ] 応用６
- [ ] スッキリわかるSQL入門

---
## 一言

ギリギリ応用６終わらなかった、、、
今週中には、9か10まで進めて来週には、卒制に本格的に取り組みたいっすね！

---
## 学習内容

### SQL

##### 3つ代表的な副作用

説明：
DBMSに対して、複数の利用者が同時に処理を要求すると
発生する副作用は次の3つがあります！

##### 1 ダーティーリード

説明：  
まだコミットされていない未確定の変更を  
他の人（別トランザクション）が読めてしまう副作用を指します。（ダーティーリード）

これが起こると、  
他トランザクションが **“存在しない値” を元に処理してしまう** という問題が発生します

たとえば、トランザクションAで更新処理を行っている最中に、 
トランザクションAはまだ COMMIT しておらず、後で ROLLBACK される予定だったとします
このとき、ほぼ同時に実行された別のトランザクションBが
A の未確定（仮の）値を読み取ってしまうと

- その値を使って計算
- その値を元に処理
- その値を元に注文・決済・在庫管理などのロジック
    

といった **本来行うべきでない処理** を実行してしまいます

しかし実際には、トランザクションAは最終的に ROLLBACK されるため  
B が読み取った値は **最初から存在しなかった“幻の値”** となります
その結果、B が行った処理はすべて誤った情報を前提に進められてしまい
データ整合性が破壊される危険があります

##### 2 反復不能読み取り

説明：
あるテーブルに対してSELECT文を実行後、他の人がUPDATE文でデータを書き換えると
再び、SELECTした際に検索結果が異なってしまう副作用を指します！

これは、何が困るかというと、、、
例えば、家計簿テーブルの統計を取るために
1. 出金額の合計を集計する
2. 出金額の最大値を集計する
という処理を2つのSELECT文を順番に実行しているとします！

すると、1つ目の SELECT で「合計」を計算したあと、  
その合計値に含まれるはずの **特定の行が、他の人によって書き換えられてしまう** 可能性があります。

例えば──  
最初の SELECT 時点では「3,000円」だった出金が、  
2つ目の SELECT に進む直前に、別のユーザーによって **「30,000円」に修正（UPDATE）** されたとします。

すると、、、

- 1つ目の SELECT（合計）は **古い値（3,000円）** のまま計算されている
    
- 2つ目の SELECT（最大値）は **新しい値（30,000円）** を参照してしまう
    

という **矛盾した状態** が発生してしまいます！

結果的に、

> 「合計値」と「最大値」が、同じデータを対象にしたはずなのに整合していない  
> （同じ時点のテーブルに対して集計したように見えない）

という問題が起こります。

##### ３ ファントムリード

説明：  
反復不能読み取りでは「同じ行を読みなおしたのに“値”が変わってしまう」問題でした。  
しかし、もう1つ厄介な副作用があります。それが **ファントムリード（phantom read）** です！

ファントムリードとは、  
**同じ SELECT 文を2回実行したのに、“行の数” が変わってしまう** 現象を指します

これがどういうときに困るかというと、、、

例えば、家計簿テーブルで次のような統計を取るケースを考えてみます

1. 出金額が 3,000円以上のレコードを取得して件数を数える
2. その条件に当てはまる出金の合計金額を計算する

この2つを順番に SELECT 文で処理しているとします

---

さて、1つ目の SELECT で  
「3,000円以上の出金は 10 件だな！」  
と集計した直後に、、、

**別のユーザーが新しい出金データ（例えば 5,000円）を INSERT した** とします。

すると、、、

- 1回目の SELECT（件数）は **10件**
    
- 2回目の SELECT（合計）は、INSERT された行も含まれ **実質11件分の合計** になってしまう
    

というおかしな状態が生まれます。

---

つまり、

> 「存在しなかったはずの行が、2回目の SELECT では“突然現れた”ように見える」
---
## 学んだこと

- 3つ代表的な副作用
	- ダーティーリード
	- 反復不能読み取り
	- ファントムリード



---
## 教材

- スッキリわかるSQL入門



---
##### ⏳ 学習時間: ６時間  
##### 🌱 コミット数: １コミット