#Model #責務

と

## 結論

> **モデルの責務は  
> 「ドメイン（業務・データ）のルールを守り、状態を正しく保つこと」**

ControllerでもViewでもありません。

---

## Railsにおける Model の役割（公式的まとめ）

モデルは主にこの4つを担当します。

---

## ① データの表現（DBとの対応）

```ruby
class Post < ApplicationRecord
end
```

- posts テーブル ↔ Postモデル
- カラム・型・関連を表現する
- ActiveRecord が DB 操作を抽象化する

👉 **「このアプリには Post という概念がある」**を表す

---

## ② 関連（Association）の管理

```ruby
class Post < ApplicationRecord
  has_many :post_tags
  has_many :tags, through: :post_tags
end
```

- Post と Tag の関係
    
- 1対多 / 多対多 / 従属関係
    

👉 **データ同士の関係性の責任者**

---

## ③ 制約・ルール（Validation）

```ruby
validates :title, presence: true
validates :body, length: { maximum: 1000 }
```

- 空ではダメ
    
- 長すぎたらダメ
    
- 一意であるべき
    

👉 **「保存していい状態かどうか」を判断する**

📌 Controller は「保存を試みる」だけ  
📌 OKかどうか決めるのは Model

---

## ④ ドメインロジック（今回の核心）

```ruby
def save_tags
  tag_names = tag_list.to_s.split(',').map(&:strip).uniq
  self.tags = tag_names.map { |name| Tag.find_or_create_by(name: name) }
end
```

これは：

- Post が
- 自分に紐づく Tag を
- どう扱うか

👉 **完全に Post の責務**

---

## ❌ Modelがやってはいけないこと


|やってはいけない|理由|
|---|---|
|params を直接触る|HTTP依存になる|
|redirect / render|Controllerの責務|
|HTMLを生成|Viewの責務|
|current_user を参照|Controller/Viewの責務|

---

## MVCで整理するとこう

```text
Controller：何が起きたか（HTTP）
Model     ：それは正しいか（ルール）
View      ：どう見せるか（表示）
```

---

## 今回の「タグ保存」を責務で分解すると

|処理|責務|
|---|---|
|フォーム入力|View|
|params 取得|Controller|
|post を作る|Controller|
|タグをどう解釈するか|✅ Model|
|Tagとの関連を更新|✅ Model|
|成功時の画面遷移|Controller|

---
