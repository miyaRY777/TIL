#daily

## 今日取り組んだタスク

- [ ] Rails応用３ 完了
- [ ] Rails応用4
- [ ] スッキリわかるSQL入門

---
---
## 一言

着実にRails応用を終わらせて行っております、、、
このまま今週中には、応用７ぐらいまでに進めておきたいっすね！
今月までには、応用ステップが終わるかどうかまで進めていきたいです！

---
---
## 学習内容

### SQL

##### 複数行副問い合わせ

説明：
検索結果がn行1列の複数の値となる副問い合わせを指しています！
また、複数の値との判定を行うWHERE句の条件やSELECT文のFROM句に記述できます！

IN演算子で利用する場合：

SQL：
```sql
SELECT * FROM 家計簿集計
 WHERE 費目 IN ('食費', '水道光熱費', '教養娯楽費', '給料')
```

出力：

![[スクリーンショット 2025-11-17 23.00.06.png]]


さらにINで副問い合わせを利用した場合

SQL：
```sql
SELECT * FROM 家計簿集計
 WHERE 費目 IN (SELECT DISTINCT 費目 FROM 家計簿)
```

補足
（）の中は、費目の種類一覧に変化している

出力：同じものが出力される

![[スクリーンショット 2025-11-17 23.00.06.png]]


ANY/ALL演算子で利用するする場合

説明：
復習として
ANY演算子は、（）の中にある値のそれぞれと比較して、いずれかが真なら真となります！
ALL演算子は、（）の中になる値のそれぞれと比較して、すべてが真なら真となります！

具体例：副問合せの結果で得られる複数の値のいずれかより出金額が小さいものを出力！

家計簿テーブル
![[スクリーンショット 2025-11-17 23.21.51.png]]

家計簿アーカイブ
![[スクリーンショット 2025-11-17 23.22.03.png]]

SQL：
```sql
SELECT *
FROM 家計簿
WHERE 費目 = '食費'
AND 出金額 < ANY (SELECT 出金額 FROM 家計簿アーカイブ WHERE 費目 = '食費')
```

出力：
```sql
|日付|費目|メモ|入金額|出金額|

|2024-02-03|食費|コーヒーを購入|0|380|
```


##### エラーになってしまう副問い合わせ

説明：
`SELECT * FROM 家計簿 WHERE 出金額 < 30000`の30000の部分に
複数行副問い合わせを記述するとエラーになってしまいます！
なぜなら
複数行副問い合わせは、結果がn行1列、つまり複数の値となります！
IN演算子やANY演算子の「（カンマで区切った値の列挙）」の代わりに記述できますが
単一の値の値の代わりに記述することはできません！
だから、30000を複数行福問い合わせで書き換えることができないんです！
その代わりに
等号や不等号にANY/ALL演算子やIN/NOT IN演算子を記述することならできます！

具体例：ANY（どれか1つでも条件を満たせば true）
```sql
SELECT *
FROM 家計簿
WHERE 出金額 < ANY (
  SELECT 出金額
  FROM 家計簿アーカイブ
  WHERE 費目 = '食費'
);
```

具体例：## ALL（すべての値と比較して true なら true）
```sql
SELECT *
FROM 家計簿
WHERE 出金額 < ALL (
  SELECT 出金額
  FROM 家計簿アーカイブ
  WHERE 費目 = '食費'
);
```


##### 副問い合わせとNULL

説明：
```sql
SELECT *
FROM 家計簿
WHERE 費目 NOT IN ('食費', '水道光熱費', NULL)
```
のようにNULLが含まれていると、NULLかどうかを判定するための
IS NULL演算子 か IS NOT NULL演算子を利用する必要があります！！！
でないと、最終的な結果は何も得られない、、、何の成果も得られない調査兵団となります

##### 副問い合わせの結果から確実にNULLを除外する方法

具体例１：IS NOT NULL条件を使う場合

家計簿アーカイブテーブル
![[スクリーンショット 2025-11-18 3.34.08.png]]

家計簿テーブル
![[スクリーンショット 2025-11-18 3.27.29.png]]

SQL：
```sql
SELECT *
FROM 家計簿アーカイブ
WHERE 費目 IN (SELECT 費目 FROM 家計簿 WHERE 費目 NOT IN NULL)
```

出力：
```sql
|日付|費目|メモ|入金額|出金額|

|2023-12-10|給料|11月の給料|280000|0|
|2023-12-18|水道光熱費|水道代|0|4200|
|2023-12-24|食費|レストランみやび|0|5000|
|2024-01-10|給料|12月の給料|280000|0|
|2024-01-13|教養娯楽費|スッキリシネマズ|0|1800|
|2024-01-13|食費|新年会|0|5000|
```

補足
出力結果には、居住費がない
IN演算子によって、右辺にNULLが含まれていても、等しい値が1つでもあれば、結果を得ることができます！

具体例２：COALESCE関数を使ってNULLを別の値に置き換える場合
```sql
SELECT *
FROM 家計簿アーカイブ
WHERE 費目 IN (SELECT COALESCE(費目, '不明') FROM 家計簿)
```

補足
COALESCE関数を利用することで、費目がNULLなら、代わりに不明に置き換える！

---
---
## 学んだこと

- 複数行副問い合わせ
	-  IN演算子を利用する場合
	- ANY/ALL演算子で利用するする場合
- エラーになってしまう副問い合わせについて
- 副問い合わせとNULLについて


---
---
## 教材

- スッキリわかるSQL入門


---
---
##### ⏳ 学習時間: ６時間  
##### 🌱 コミット数: １コミット