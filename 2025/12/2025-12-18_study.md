#Swiper 


---

## 結論

```ruby
has_many_attached :main_images
```

の **`main_images`** とは：
> **「このモデルに紐づく“複数の添付ファイルの名前（論理名）」**です。

---

## ① `main_images` は「カラム名」ではない

まず重要な誤解を解きます。

❌ **`sites` テーブルに `main_images` カラムができる**  
⭕ **できません**

ActiveStorage では：
- 添付ファイル用のカラムは作らない
- 代わりに **専用テーブル**を使う

---

## ② `main_images` の正体（正確な定義）

`main_images` は：
- ActiveStorage が使う **attachment の name**
- DB では **文字列として保存**される
- 「この添付は何用か」を識別するラベル

---

## ③ DB ではどこに保存される？

### active_storage_attachments テーブル

|カラム|意味|
|---|---|
|`name`|添付の論理名（例: `"main_images"`）|
|`record_type`|紐づくモデル名（例: `"Site"`）|
|`record_id`|モデルの id|
|`blob_id`|ファイル本体|

あなたが見たログ👇

```ruby
name: "main_images"
record_type: "Site"
record_id: 1
```

👉 **`main_images` がここに保存されている**

---

## ④ なぜ名前が必要なのか？

1つのモデルに  
**複数の添付の種類**を持たせるためです。

```ruby
class Site < ApplicationRecord
  has_one_attached  :favicon
  has_one_attached  :og_image
  has_many_attached :main_images
end
```

このとき ActiveStorage は：

|添付|name|
|---|---|
|favicon|`"favicon"`|
|og_image|`"og_image"`|
|main_images|`"main_images"`|

で区別します。

---

## ⑤ コード上での意味

### `site.main_images` と書くと？

👉 Rails は内部でこう考えます：

```ruby
ActiveStorage::Attachment.where(
  record_type: "Site",
  record_id: site.id,
  name: "main_images"
)
```

それをラップして  
**`ActiveStorage::Attached::Many`** を返す。

---

