#daily

## 今日取り組んだタスク

- [ ] 中間試験:Ruby
- [ ] Web技術の基本
- [ ] チェリー本

---
---
## 一言

昨日に引き続き、チェリー本と中間試験のRubyを中心に学習してました！
中間に関しては、ようやく終わりが見えそうです！
今週中にRailsは行けそうですが、、、終わるかどうか未知数です、、、

---
---
## 学習内容
## Ruby


### 12.2.1 実行環境によって変化するバックとれーすの表示形式

Ruby3.0.1の出力結果に対して
Ruby2.7.3の場合、以下のように出力されます！
```ruby

# Ruby3.0.1
$ ruby lib/blacktrace_sample.rb
(プログラムのパス)/lib/gate.rb:24:in calc_fare': undefined local variable or method distanse'
for #<Gate:0x0000000105064df0 @name="mikun"> (NameError)
Did you mean?  distance
	from (プログラムのパス)/lib/gate.rb:14:in `exit'
	from lib/blacktrace_sample.rb:9:in `<main>'
```

```ruby
# Ruby 2.7.3
$ ruby lib/blacktrace-sample.rb
Traceback (most recent call last):
	1: from lib/blacktrace-sample.rb:9:in `<main>'
lib/gate.rb:42:in `exit': undefined local variable or method `distanse' 
for #<Gate:0x0000000101496250 @name="niikuni"> (NameError)
Did you mean?  distance

```

##### 解説
`Traceback（most recent call last）`
エラーが起きたとき、「これからエラーの履歴を表示するYO」という合図を示す文言のこと！

Rubyのバージョンが男なったり、irbやMinitestなどのツールを経由することで、出力形式に変化はありますが
エラー情報自体には大きな違いはありません！


### 12.3 よく発生する例外クラスとその原因

#### NameError
```ruby
# distanceをdistanseとタイプミスした場合
undefined local variable or method 'distanse' for #<Gate:0x00000001393e85e8 ...>(NameError)


# dateライブラリをrequireせずにDateクラスを使おうとした場合
uninitialized constant Date (NameError)
```

##### 説明：
ローカル変数や定数が定義されていないと、呼び出したときにエラーが発生したり
また、外部ファイルや外部ライブラリのrequireを忘れた時も同様に発生します！


#### NoMethodError

説明：
存在しないメソッドを呼び出そうとしたときに発生するエラーのことです！

原因
- 単純にメソッド名を打ち間違えている
```ruby
# stamped_atメソッドを間違えてstamped_onと入力した場合
undefined method 'stamped_on' for #<Ticket:0x000000012e ...>(NoMethodError)
```

Rubyは `Ticket` クラスのインスタンスに対して `stamped_on` というメソッドを探していますが
クラス定義の中に `stamped_on` というメソッドが存在しないため、エラーになっています！


- privateメソッドをクラスの外部から呼び出している
```ruby
# privateメソッドのbarをクラスの外部から呼び出そうとした場合
private method `bar' called for #<Foo:0x000000012e33e1c0> (NoMethodError)
```

barはprivateに定義したメソッドなので、同じクラスの内部しか呼び出せません！
これはメソッド自体は存在しますが、スコープ（呼び出し可能な範囲）外なので、呼び出すことができません！

対処法
外部から呼びたい場合は `public` にする。
もしくはクラス内の別メソッドを通して呼ぶようにする。


- レシーバの型（クラス）が想定していた型と異なる
```ruby
# シンボルに対してcharsメソッドを呼び出してしまった場合
undefined method `chars' for :japan:Symbol (NoMethodError)
```

`chars` メソッドは **文字列（String）用** のメソッドです！
ここでは、レシーバは`:japan（Symbol）`となっているので、charsメソッドは使えません...

対処法
データ型を確認して、必要なら変換する。
`:japan.to_s.chars  #=> ["j", "a", "p", "a", "n"]`

メソッドチェーンの途中でレシーバが変わっていないかを確認する


- レシーバが想定に反してnilになっている
```ruby
# ticket.fareを呼び出したが、ticketがnilだった場合
undefined method `fare' for nil:NilClass (NoMethodError)
```

`nil`（何もない値）は Ruby では `NilClass` のインスタンスです。
`NilClass` は `fare` メソッドを持っていないため、呼ぶと `NoMethodError` になります。

対処法
変数が `nil` でないか事前にチェックする。
```ruby
if ticket
	ticket.fare
end
``` 
または安全ナビゲーション演算子 `&.` を使う。
`ticket&.fare  # ticketがnilでもエラーにならない`


####  TypeError

説明：
`TypeError` は **「型（クラス）が合っていない」** ときに出るエラーです！

```ruby
# 10 + '1'のように整数と文字列を加算しようとした場合  
String can't be coerced into Integer (TypeError)
```
これは、文字列型は、整数型に強制変換できませんという意味


具体例：

1. 異なる型の演算

`String`クラスのオブジェクトと`Integer`クラスのオブジェクトを`+`演算子で結合しようとすると、`TypeError`が発生します。 
```ruby
# 文字列と整数の結合
"年齢は" + 25 + "歳です"
#=> TypeError: no implicit conversion of Integer into String
```


**原因**: 文字列`"年齢は"`に整数`25`を結合することはできません。`+`演算子は、両辺が同じ`String`型であることを期待しています。  


**解決策**: 整数を文字列に明示的に変換します。 
```ruby
"年齢は" + 25.to_s + "歳です"
#=> "年齢は25歳です"
```


2. メソッドの呼び出し

特定のクラス（型）に定義されたメソッドを、そのメソッドを持たない別のクラスのオブジェクトで呼び出そうとすると、`TypeError`が発生します。 
```ruby
# nilに対して文字列のメソッドを呼び出す
name = nil
name.upcase
#=> NoMethodError: undefined method `upcase' for nil:NilClass
```

**原因**: `upcase`は`String`クラスのメソッドであり、`nil`には定義されていません。このケースでは、より具体的な`NoMethodError`が発生することが一般的ですが、根本的な原因は型の不一致にあります。  


**解決策**: 変数が期待する型であることを確認してからメソッドを呼び出すか、nilに対応する処理を加えます。 
```ruby
name = "alice"
puts name.upcase
#=> ALICE

name = nil
puts name&.upcase
#=> nil
```


3. 不正な引数

メソッドが特定の型の引数を期待しているにもかかわらず、異なる型の引数が渡された場合も`TypeError`が発生します。 
```ruby
# 配列の先頭から2番目の要素を取得しようとしている
array = [1, 2, 3]
array.first("two")
#=> TypeError: no implicit conversion of String into Integer
```

**原因**: `Array#first`メソッドは、引数として整数を期待しています（取得する要素の数を指定するため）。しかし、ここでは文字列`"two"`が渡されたため、`TypeError`が発生しました。  


**解決策**: 適切な型の引数を渡します。 
```ruby
array = [1, 2, 3]
array.first(2)
#=> [1, 2]
```


#### ArgumentError

説明：
メソッドに渡された引数の数や値などが間違っているときの発生するエラーです！


```ruby
# 引数が必須なのに、[1, 2, 3].deleteのように引数なしでメソッドを呼んだ場合  
wrong number of arguments (given 0, expected 1) (ArgumentError)
```

メソッドが期待する引数と実際に渡される引数の数が合わない場合に発生！
`Array#delete`メソッドは、削除したい要素を引数として1つ指定する必要があります！


```ruby
# 正の値を渡すべきメソッド（演算子）に対して、1 * -a のように負の値を渡した場合  
negative argument (ArgumentError)
```

本来「正の値（0以上）」を引数として受け取るメソッドに「負の値」を渡してしまったときに出るエラーです


---
### Web技術の基本

#### JSON

説明：
データをやり取りするための軽量なフォーマットで
人間にも読みやすく、コンピュータにも扱いやすいデータの書き方のことを指してます！
また、特定のプログラミング言語には依存せず、汎用性の高いテキスト形式になっている



---
---
## エラーと対応

- エラー内容：
    
- 対処方法：


---
---
## 学んだこと

- NameErrorについて
- NoMethodErrorについて
- TypeErrorについて
- ArgumentErrorについて
-  JSONについて


---
---
## 教材

- Web技術の基本
- チェリー本

---
---
##### ⏳ 学習時間: 6.8時間  
##### 🌱 コミット数: １コミット