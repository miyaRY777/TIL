#daily

## 今日取り組んだタスク

- [ ] Rails応用７
- [ ] スッキリわかるSQL入門

---
## 一言

Rails応用７、、、思った以上に時間がかかりました💦
ラジオボタン全然綺麗に表示されない！これに2日ぐらい試行錯誤してました笑
明日、さっと終わらせて、Rails応用８いきたいっすね！


---
## 学習内容
### Ruby / Rails
```ruby
# 書いたコード
```

### SQL

### デッドロックとは？

説明：

DBで同時にたくさんのトランザクションが実行されると！？
稀にデッドロックと呼ばれる状態になり、トランザクションの処理が途中で永久に止まってしまいます、、、

発生条件：

- トランザクションAが「X」をロック、次に「Y」をロックしようとしている一方で
- トランザクションBは「Y」をロック、次に「X」をロックしようとしています
- この時、デッドロックが発生します！

具体例：

| 名義人  | 残高     |
| ---- | ------ |
| 田中太郎 | 820000 |
| 伊藤一郎 | 70000  |

1. トランザクションAが田中の行をロック
2. トランザクションBが伊藤の行をロック
3. 次にトランザクションAは、伊藤をロックしようとするが、すでにロック済みなので 解除されるまで待機
4. 一方、トランザクションBは次に田中をロックしようとしますが、これもロック済みなので解除されるまで待機
5. 結果、お互い待機中で止まってしまう！これがデッドロックです！

### デッドロック解消方法

説明：

多くのDBMSには、このデッドロックを自動的に解消するための仕組みがあります！
それは
DBMSが実行中のトランザクションの中に、デッドロックがないか定期的に調べ、もし発見できたら！？
片方のトランザクションを強制的に失敗（ロールバック）させて、デッドロック状態から抜け出します！

### デッドロックを予防

説明：

上に書いた通り、デッドロックを解消する方法はありますが
少なくとも1つのトランザクションを失敗させたり、処理が停止してしまう時間を考えると
可能な限り、デッドロックは避けたいです！

このとき、対策として

1. トランザクションの時間を短くする
2. 行やテーブルを同じ順番でロックする
    1. 2つのトランザクションがそれぞれ「X→Y」「Y→X」の順番でロックを試みてましたが これを「X→Y」の順番で揃える！

これらを意識して、SQL文を工夫していきます！

補足

- ロックエスカレーションについては、まだ調べていない。。

---
## 学んだこと

- デッドロックについて
	- デッドロックの解消
	- デッドロックの予防
---
## 教材

- スッキリわかるSQL入門

---
##### ⏳ 学習時間: ７時間  
##### 🌱 コミット数:１コミット 