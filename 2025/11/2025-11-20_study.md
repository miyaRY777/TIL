#daily

## 今日取り組んだタスク

- [ ] Rails応用４
- [ ] スッキリわかるSQL入門

---
## 一言

Rails応用４は、少し時間がかかりましたがあと少しで終わりそうです😄
久しぶりに朝から学習が進められたので、このまま続けていきたいっすね！


---
## 学習内容
### Ruby / Rails

### Rakeとは？

`Rake`とは、`Ruby`で書かれたコードを`タスク`として作成しておく 必要に応じて呼び出し実行する事が出来る機能。

Rakeの補足
`Rake`が実行する処理内容を`Rakeタスク`と呼び、定義する場所を`Rakefile`と呼ぶ

`rakeタスク`を利用する場面

・何かしらのデータの連携
・データベースのバックアップ
・定期的にデータを更新、削除する


### Rakeタスクの作り方

`Hello`と簡単な挨拶を表示するタスクを作成。

まず最初にタスクファイルを生成する。

```ruby
$ rails g task ファイル名
↓
$ rails g task greet
```

上記のコマンドで、`lib/tasks`配下に`greet.rake`というファイルが生成されていて、ファイルの中身は以下のようになっている。

```ruby
namespace :greet do
end
```

この中に処理を記入していくことで、定義が完了する。

```ruby
# 基本形
namespace :greet do
  desc "タスクの説明" #desc → description（説明）
  task task_name: :environment do #task_nameは自由につけられる
    # 実行したい処理を記述する場所
  end
end

# lib/tasks/greet.rake
namespace :greet do
  desc "Helloを表示するタスク"
  task say_hello: :environment do
    puts "Hello"
  end
end

```

記入し終えたら、タスクが表示されるか確認をする。

```ruby
$ rake -T   #←現在のアプリに定義されているタスク一覧が表示されるコマンド
rake greet:say_hello                    # Helloを表示するタスク
```

今度はタスクを実行して確認。`Hello`が返ってきたら成功。


### Wheneverとは？

**Whenever**は Ruby/Rails で**cron（定期実行処理）を簡単に設定できるgem**です。

📝 できること

- 毎日〇時にRakeタスクを実行したい
- 10分ごとにバッチ処理を回したい
- 週1回メール送信を自動実行したい

→ こんな「定期実行バッチ」を Rails で簡単に書けます。

### cronとは？

「クロン」または「クーロン」と呼ばれ`○時になったら○○のコマンドを実行`といった具合に、定期的にコマンドを実行するためにメモリ場で常に命令を待機しているプロセス。

この`cron`に対して命令を行うには、`crontab`に記述しておけば、決まった時間に実行してくれる。

※UNIX系のOSには、`cron`が標準で備わっている。

### find_eachとは？

**大量のレコードを一度にメモリへ読み込まず、バッチ（小分け）で取り出して処理する** ためのメソッドです。
Rails では内部的に `find_in_batches` を使い、**デフォルト1000件ずつ**レコードを取得しながら、1件ずつ yield します。

##### なぜ使うのか？

###### ❌ ダメな例

```ruby
User.all.each do |user|

```

➡ **全レコードを一気に読み込むため、メモリを大量消費**

➡ レコード数が多いとサーバー落ちる危険あり

###### ⭕ `find_each`

```ruby
User.find_each do |user|

```

➡ 1000件ずつ処理していくため、**メモリ消費が抑えられる**

大量データ処理（数十万〜数百万件）で特に重要。

___

### SQL

##### 複数にテーブルを分けるメリット

説明：
次のようなテーブルがあったとします
```sql
UPDATE 家計簿
SET 費目 = '給与手当'
WHERE 費目 = '給料'
```
家計簿テーブルには、10万行のレコードが格納されているとします！
SQL文を実行したとき、一行ずつ条件に合うかどうか調べて書き換えていくので
めっちゃ大変で、負荷がかかります。。
ここで、費目カラムだけを取り出したテーブルを作って、同じようにSQL文をかくと、、、
```sql
UPDATE 費目
SET 費目 = '給与手当'
WHERE 費目 = '給料'
```
似たような文になりましたが
こっちの方が費目の種類が多くても、せいぜい100個程度なので
負荷の違いは歴然です！

---
## 学んだこと

- Rakeについて
- Wheneverについて
- cronについて
- find_eachについて
- 複数テーブルに分けるメリットについて
---
## 教材

- スッキリわかるSQL入門

---
##### ⏳ 学習時間: 8時間  (ただし、計測はされていない)
##### 🌱 コミット数: １コミット