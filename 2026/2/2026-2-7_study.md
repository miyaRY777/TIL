

# TIL：Ransackとは何か？

## 概要

**Ransack** は、Ruby on Rails で **検索機能を簡単に実装できるgem**。
フォームから送られた検索条件をもとに、ActiveRecordのクエリを自動生成してくれる。

---

## 初学者向けに一言で

👉 **「検索フォームとDB検索をつなげてくれる便利ライブラリ」**

---

## 何が嬉しいのか？

Railsで検索機能を自前で書くと👇

* where句が増えて複雑になる
* if文だらけになる
* 複数条件検索がしんどい

Ransackを使うと👇

* フォーム1つで複数条件検索
* AND / OR 検索が簡単
* コントローラがスッキリ

---

## 基本的な使い方（例）

### ① コントローラ

```ruby
def index
  @q = Hobby.ransack(params[:q])
  @hobbies = @q.result
end
```

### ② View（検索フォーム）

```erb
<%= search_form_for @q do |f| %>
  <%= f.label :name_cont, "趣味名" %>
  <%= f.search_field :name_cont %>
  <%= f.submit "検索" %>
<% end %>
```

---

## `_cont` って何？

これは **検索条件（predicate）** を表す。

| 書き方          | 意味              |
| ------------ | --------------- |
| `name_cont`  | name に **含まれる** |
| `name_eq`    | name が **完全一致** |
| `name_start` | name が **前方一致** |
| `name_end`   | name が **後方一致** |

👉 `cont` = contains（含む）

---

## 実際に生成されるSQLイメージ

```ruby
name_cont = "rails"
```

⬇

```sql
SELECT * FROM hobbies
WHERE name LIKE '%rails%'
```

---

## よく使うpredicateまとめ

| predicate | 意味      |
| --------- | ------- |
| `_cont`   | 部分一致    |
| `_eq`     | 完全一致    |
| `_in`     | 配列に含まれる |
| `_gteq`   | 以上      |
| `_lteq`   | 以下      |

---

## 複数条件検索も簡単

```erb
<%= f.search_field :name_cont %>
<%= f.search_field :created_at_gteq %>
```

👉 **自動で AND 検索**になる。

---

## なぜRailsでよく使われる？

* 標準的
* 学習コストが低い
* 中小規模アプリにちょうどいい
* RUNTEQ課題・卒制でも頻出

---

## 注意点（TILメモ）

* paramsは `params[:q]` を使う
* モデルに紐づいたカラム名しか検索できない
* JOIN先の検索もできるが設定が必要

---

## まとめ（1行）

👉 **Ransackは「検索条件を意識せずに検索機能を作れるRailsの定番gem」**

---

