#ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆ #Ruby_on_Rails #ä¸­é–“è©¦é¨“_Rails #create


```ruby
# app/controllers/posts_controller.rb
def create
  @post = Post.new(post_params)
  
  if @post.save
    @post.save_tags  # â† ã“ã“ã§å‘¼ã¶
    redirect_to @post
  else
    render :new
  end
end

private

def post_params
  params.require(:post).permit(:title, :body, :tag_list)
end
```

---

## å…¨ä½“åƒï¼ˆã¾ãšã¯æµã‚Œã‚’æ´ã‚€ï¼‰

```
ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
   â†“
params
   â†“
Post.new
   â†“
@post.saveï¼ˆDBä¿å­˜ï¼‰
   â†“
ã‚¿ã‚°ä¿å­˜ï¼ˆé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œï¼‰
   â†“
è©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§»
```

---

## â‘  `@post = Post.new(post_params)`

```ruby
@post = Post.new(post_params)
```

### ä½•ã‚’ã—ã¦ã„ã‚‹ï¼Ÿ

- ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸ `params` ã‚’ä½¿ã£ã¦
- **ã¾ã DBã«ä¿å­˜ã•ã‚Œã¦ã„ãªã„ Post ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã‚’ä½œã£ã¦ã„ã‚‹

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

- ã“ã®æ™‚ç‚¹ã§ã¯ **id ã¯ã¾ã ç„¡ã„**
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ **ã¾ã èµ°ã£ã¦ã„ãªã„**
- `tag_list` ã‚‚ã“ã“ã§ã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼ˆ`attr_accessor`ï¼‰
```ruby
# app/models/post.rb
attr_accessor :tag_list
```

---

## â‘¡ `if @post.save`

```ruby
if @post.save
```

### ä½•ã‚’ã—ã¦ã„ã‚‹ï¼Ÿ

- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
- å•é¡Œãªã‘ã‚Œã° **posts ãƒ†ãƒ¼ãƒ–ãƒ«ã« INSERT**
- æˆåŠŸã™ã‚‹ã¨ `true` ã‚’è¿”ã™

### ã“ã®ç¬é–“ã«èµ·ãã‚‹ã“ã¨

- `@post.id` ãŒç¢ºå®šã™ã‚‹
- `created_at / updated_at` ãŒå…¥ã‚‹
- **ã‚¿ã‚°ã®ç´ä»˜ã‘æº–å‚™ãŒæ•´ã†**

ğŸ‘‰ **ã“ã“ãŒåˆ†å²ç‚¹ï¼ˆè¶…é‡è¦ï¼‰**

---

## â‘¢ `@post.save_tags`

```ruby
@post.save_tags
```

### ãªãœã“ã“ã§å‘¼ã¶ã®ã‹ï¼Ÿ

**ç†ç”±ã¯1ã¤ã ã‘**

> ğŸ”´ PostãŒä¿å­˜ã•ã‚Œã¦ã„ãªã„ã¨  
> ğŸ”´ `post_id` ã‚’ä½¿ã£ãŸã‚¿ã‚°ç´ä»˜ã‘ãŒã§ããªã„

---

### save_tags ã®è²¬å‹™ï¼ˆæƒ³å®šï¼‰

```ruby
class Post < ApplicationRecord
  def save_tags
    tag_names = tag_list.to_s.split(',').map(&:strip).reject(&:blank?).uniq

    self.tags = tag_names.map do |name|
      Tag.find_or_create_by(name: name)
    end
  end
end
```

#### ã“ã“ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨

- `tag_list`ï¼ˆä»®æƒ³å±æ€§ï¼‰ã‚’è§£æ
- `tags` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
- `posts_tags`ï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã‚’æ›´æ–°

ğŸ‘‰ **Postè‡ªèº«ã«é–¢ä¿‚ã™ã‚‹å‡¦ç†ãªã®ã§ Model ã«ç½®ãã®ãŒæ­£è§£**

---

## â‘£ `redirect_to @post`

```ruby
redirect_to @post
```

### ä½•ã‚’ã—ã¦ã„ã‚‹ï¼Ÿ

- `/posts/:id` ã«é·ç§»
- **äºŒé‡é€ä¿¡é˜²æ­¢**
- URLãŒå¤‰ã‚ã‚‹ï¼ˆPRGãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

ğŸ‘‰ ä¿å­˜æˆåŠŸå¾Œã¯ **å¿…ãš redirect**

---

## â‘¤ `else render :new`

```ruby
else
  render :new
end
```

### å¤±æ•—æ™‚ã®å‹•ã

- DBä¿å­˜ã•ã‚Œã¦ã„ãªã„
- `@post.errors` ãŒæ®‹ã‚‹
- å…¥åŠ›å€¤ã‚’ä¿æŒã—ãŸã¾ã¾ `new` ã‚’å†è¡¨ç¤º

ğŸ‘‰ **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºç”¨**

---

## ãªãœ Controller ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã‹ãªã„ï¼Ÿ

âŒ æ‚ªã„ä¾‹

```ruby
def create
  # ã‚¿ã‚°å‡¦ç†ãŒã“ã“ã«ãƒ™ã‚¿æ›¸ã
end
```

â­• è‰¯ã„ä¾‹ï¼ˆä»Šã®å½¢ï¼‰

```ruby
@post.save
@post.save_tags
```

### ç†ç”±

- Controllerã¯ã€Œæµã‚Œã®åˆ¶å¾¡ã€
- Modelã¯ã€Œãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯ã€
- **ãƒ†ã‚¹ãƒˆãƒ»å†åˆ©ç”¨ãƒ»å¯èª­æ€§ãŒæ®µé•ã„**

---

## ã“ã®ã‚³ãƒ¼ãƒ‰ãŒç¤ºã™ Railsçš„è¨­è¨ˆ

|å½¹å‰²|æ‹…å½“|
|---|---|
|paramså—ã‘å–ã‚Š|Controller|
|ä¿å­˜å¯å¦åˆ¤æ–­|Model|
|DBæ“ä½œ|Model|
|ã‚¿ã‚°ç®¡ç†|Model|
|ç”»é¢é·ç§»|Controller|

---
