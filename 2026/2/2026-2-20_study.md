# 「Dockerでsystem spec（Turboのインライン編集）を動かす」までの流れ

## ✅ 何が問題だった？

- system spec 実行で **Selenium が chromedriver に接続できない**エラーが出た
- 原因は **Dockerコンテナにブラウザ（Chrome/Chromium）が入っていなかった**ため


---

## ✅ 解決までにやったこと（全体像）

### 1) **どのDockerfileが使われているか確認**

- ログで `Dockerfile.dev` がビルド対象だと分かった  
    → 本番用Dockerfileを直しても反映されない状態だった

### 2) **Dockerfile.dev にブラウザを追加**

- Mac（aarch64）なので **Google Chrome ではなく Chromium** を採用
    
- 追加したもの：
    - `chromium`
    - `chromium-driver`
    - 依存ライブラリ（gtk/nss など）

### 3) **ビルドし直して反映**

- `--no-cache` 付きで rebuild して確実に反映させた

### 4) **Chromiumが入ったことを確認**

- コンテナ内でバージョン確認して、両方入っていることが確定
    - `chromium --version`
    - `chromedriver --version`

### 5) **RSpec/Capybara（Selenium）設定を整えた**

- `spec/support/capybara.rb` を作成
- `rails_helper.rb` で `spec/support` を require する設定を有効化
- Docker向けに必須オプションを追加：
    
    - `--no-sandbox`
    - `--disable-dev-shm-usage`
- Turboを動かすspecは `js: true` を付ける
    

### 6) **Selenium起動は成功 → 次は実装の問題に移行**

- driver 起動は成功したが、表示が更新されずテストが落ちた  
    → ここは **Turboインライン編集のupdate/置き換え実装が未反映**だった
    

### 7) **インライン編集の更新が反映されるように実装してテスト成功**

- update処理（Room label更新）
- Turbo Frame/Stream で行単位更新
- system spec で表示更新を確認できるようになり、成功

---

## ✅ 最終成果

- **Docker環境だけで system spec（Turboのインライン編集）を安定して回せる状態**になった
- つまり「Docker + Rails + Hotwire + RSpec system spec」ラインが完成！
    
