#daily

## 今日取り組んだタスク

- [ ] Rails応用４
- [ ] スッキリわかるSQL入門

---
## 一言

いよいよ、ちょこちょこ進めてたスッキリわかるSQL入門の8章も終わりそうっすね
全部で12章あるので、あと少しです！
頑張って終わらせます！っと言いたいんですけど、カリキュラムもあるのでそっちを優先にしつつ、頑張ります。。。

---
## 学習内容

### SQL

##### joinメソッド

説明：
**複数のテーブルを結合して、1つの結果として取り出すためのSQL文**のことを指します！
主役はFROM句で指定したテーブルで、それにJOIN句で指定したテーブルの内容を必要に応じて
DBMSがつないでいきます！
このとき、DBMSは一行ずつ「どの行を一方のテーブルにつなぐべきか」を探しながら結合します！

補足
DBMSは、別テーブルへ`SELECT * FROM 別テーブル WHERE 結合条件の式`を繰り返し実行して、つなぐ行を探します！

具体例：日付、名前 AS 費目、メモを出力
```sql
/*家計簿*/
|日付|費目id|メモ|入金額|出金額|
|2024-02-03|2|カフェラテを購入|0|380|
|2024-02-05|2|昼食（日の出食堂）|0|750|
|2024-02-10|1|1月の給料|280000|0|

/*費目*/
|id|名前|備考|
|1|給料|給与や賞与|
|2|食費|食事代（ただし飲み会などの外食を除く）|
|3|水道光熱費|水道代・電気代・ガス代|
```

SQL：
```sql
SELECT 日付, 名前 AS 費目, メモ
FROM 家計簿
ON 家計簿.費目id = 費目.id

/*出力*/
|日付|費目|メモ|
|2024-02-03|食費|カフェラテを購入|
|2024-02-05|食費|昼食（日の出食堂）|
|2024-02-10|給料|1月の給料|
```

##### 結合相手が複数行の場合

左表を家計簿、右表を費目とし、次のようなテーブルがあるとすると、、、
```sql
/*家計簿（左表）*/
|日付|費目ID|メモ|
|2024-02-03|２|カフェラテ|
|2024-02-10|1|1月の給料|

/*費目（右表）*/
|ID|名前|
|1|給料|
|2|食費|
|1|仕送り|
```

費目テーブルの主キーは、本来なら重複しませんが、何かしらの理由で重複する値があったとします！
このとき
左表のID=2は、右表の食費へつながりますが
左表のID=1は、右表のID＝１である給料と仕送り、どっちにつながればいいのかわかりません
このような場合、DB MSは見つかった右表の行数に合わせて、左表の行をコピーして結合します！
つまり、イメージとして次のようになります！
```sql
|2024-02-10|1|1月の給料| + |1|給料|
|2024-02-10|1|1月の給料| + |1|仕送り|
```

結論
つなぐべき右表の行が複数あるなら
- DBMSは、左表の行を複製して、結合する！
- 結果表の行数は、元の左表の行数よりも増える！

##### 結合相手の行がない場合

説明：
結合相手が複数行の場合に対して、こちらの場合は
結合によって結果表の行数が減ってしまいます！

左表を家計簿、右表を費目とし、次のようなテーブルがあるとすると、、、
```sql
/*家計簿（左表）*/
|日付|費目ID|メモ|
|2024-02-03|２|カフェラテ|
|2024-02-05|4|昼食|

/*費目（右表）*/
|ID|名前|
|1|給料|
|2|食費|
|NULL|その他|
```

左表の費目ID=4の行は、右表からつなぐべき行が見つからない場合
DB MSは、この行に対して結合自体を諦めてしまいます、、、
なので、元々あった2月5日の行は結合結果から消滅します💦

```sql
/*結合結果*/
|2024-02-03|2|カフェラテ| + |2|食事|　のみ
```

また、左表の費目IDがNULLの場合でも、結合することなく、結合結果では消滅します

結論
結合相手がない場合（右表に結合相手に行がない || 左表の結合条件の列がNULL）
- 結合結果から消滅する

---
## 学んだこと

SQL
- joinメソッドについて
- 結合相手が複数行の場合
- 結合相手の行がない場合



---
## 教材

- スッキリわかるSQL入門

---
##### ⏳ 学習時間: 6時間  
##### 🌱 コミット数: １コミット