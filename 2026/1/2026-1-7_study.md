#RubyとRails、さらにRSpecやDeviseも学びながらSNSアプリ開発とデプロイまでこれ一本！Tailwind、CSSでデザインも抜群。初心者からエンジニアとしてのキャリアを目指す第一歩をスタートできる完全ガイド #とまだTomada #クラス変数

では、**「何をするものか → どう動くか → どこが危険か → 実務での扱い」**の順で、  
初学者でも混乱しないように解説します。

---

# クラス変数（@@変数）とは？

## 結論から

**クラス変数**とは、

> **同じクラスから作られたすべてのインスタンスで  
> 1つの値を共有する変数**

です。

```ruby
@@count
```

のように `@@` から始まるのが特徴です。

---

# クラス変数が「共有される」とはどういうこと？

## あなたの例を図で見る

```ruby
class Counter
  @@count = 0

  def self.count
    @@count
  end

  def increment
    @@count += 1
  end
end
```

### 実行の流れ

```ruby
counter1 = Counter.new
counter2 = Counter.new
```

この時点で：

```text
Counterクラス
 └ @@count = 0
```

---

```ruby
counter1.increment
```

```text
Counterクラス
 └ @@count = 1
```

---

```ruby
counter2.increment
```

```text
Counterクラス
 └ @@count = 2
```

👉 **counter1 / counter2 どちらの操作でも  
同じ @@count が増えている**

---

## 重要ポイント

- インスタンスごとに別の値 → ❌
- クラス全体で1つの値 → ✅

---

# クラス変数とインスタンス変数の違い

|種類|書き方|保持場所|
|---|---|---|
|インスタンス変数|`@count`|インスタンスごと|
|クラス変数|`@@count`|クラスで1つ|

---

# クラス変数の活用例①：カウンタ

```ruby
@@count += 1
```

### 向いている用途

- 作成回数のカウント
- 発生回数の集計

👉 **「全体で何回？」を知りたいとき**

---

# クラス変数の活用例②：設定情報の共有

```ruby
class Configuration
  @@settings = {}
end
```

### なぜ便利？

- どこからでも同じ設定を参照できる
- インスタンスを作る必要がない

```ruby
Configuration.get(:api_key)
```

👉 **アプリ全体の共通設定**

---

# ここが重要：クラス変数の注意点 ⚠️

## ① 影響範囲が広すぎる

```ruby
@@count += 1
```

これを **どこで変更しても**、  
アプリ全体に影響します。

👉 **「誰が変更したか分かりにくい」**

---

## ② テストで事故りやすい

```ruby
test1 で @@count = 2
test2 で @@count = 2 のまま
```

👉 **前のテストの状態が残る**

→ テスト前にリセットが必要

---

## ③ 継承すると挙動が直感的でない

Rubyのクラス変数は：

- 親クラス
- 子クラス

**すべてで共有されます**

👉 「クラスごとに別だと思ったら同じだった」事故が起きやすい

---

# 実務・Railsでの正直な立ち位置

## 結論

> **Railsでは、@@クラス変数はほとんど使わない**

理由：

- 影響範囲が広すぎる
- テストしづらい
- バグの原因になりやすい

---

## Railsでよく使う代替手段

### ① クラスインスタンス変数（@を使う）

```ruby
class Counter
  @count = 0

  class << self
    attr_accessor :count
  end
end
```

👉 クラス単位で安全に管理できる

[[クラスインスタンス変数を使ったクラス単位の状態管理]]

---

### ② 定数（変更しない値）

```ruby
MAX_RETRY = 3
```

---

### ③ Railsの設定機構

- credentials
- config_for
- ENV

---

# 初学者向けの正しい理解

### 覚え方

> **クラス変数 = クラスで1つの共有メモ**

---

### 使っていい場面（学習・PoC）

- 動作確認
- カウンタ
- 仕組み理解

---

### 慎重になる場面（実務）

- 状態管理
- 設定管理
- 永続データ

---

# まとめ（超重要）

- `@@変数` は **全インスタンスで共有**
- 便利だが **影響範囲が広い**
- Rails実務では使用頻度は低い
- 学習目的では「仕組み理解」に最適

---

## 一言で言うと

> **クラス変数は「強力だけど危険」  
> だから仕組みを理解して、使う場面を選ぶ**

