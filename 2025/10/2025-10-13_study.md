#daily

## 今日取り組んだタスク

- [ ] 中間試験：テーブル設計
- [ ] スッキリわかるSQL入門
- [ ] paiza Cランク 標準入力

---
---
## 一言

ER図.....正直どのように書けば分からないってのもありますが、draw.io自体不慣れなせいで
操作に慣れるのに1日のほとんどを費やしましたねw
初めて触った頃は、行や列の追加の仕方がわからず、長方形いっぱい作って、組み合わせてました笑
脳筋プレーです....

久しぶりに触った今日は、それに近いことやったのでしたorz


---
---
## 学習内容


---
### ER図

#### What: ER図とは何か？

ER図（Entity-Relationship Diagram）は、データベースの設計に利用される図式のことである！


```
- エンティティ（実体）: データを格納する対象（例: 顧客、商品、注文）を四角形で表します。
- リレーションシップ（関連）: エンティティ間の関係（例: 顧客が商品を注文する）を線で結び、ひし形で表すこともあります。
- 属性（アトリビュート）: エンティティが持つ具体的な情報（例: 顧客の名前、電話番号）を表します。
- 多重度（カーディナリティ）: エンティティ間の数量的な関係（例: 1対1、1対多、多対多）を示します。
```

#### Why: なぜER図を使うのか？

ER図を使うことで、複数のデータベース構造を視覚的に整理することができる！


```
- 設計ミスや漏れの防止: データベースのテーブル構成や関係性を事前に明確化できるため、設計段階での問題を発見しやすくなります。
- 関係者間の認識合わせ: 開発者だけでなく、プロジェクトマネージャーや顧客ともデータ構造を共有し、認識のズレを防ぎます。
- 保守・運用の安定化: 全体像を把握しやすくなるため、将来の機能追加や変更、トラブル発生時の原因特定がスムーズになります。
- 開発効率の向上: 構造が明確になることで、効率的にデータベース構築やプログラム開発を進めることができます。
```


#### How: どのようにER図を作るのか？

以下引用
```ruby
ER図は、以下の手順で作成するのが一般的です。

1. 要件を理解する: どのようなデータを扱うシステムなのかを把握します。
2. エンティティを特定する: ビジネスの要件から「データのまとまり」となるエンティティ（例: 顧客、注文、製品）を洗い出します。
3. 属性を定義する: 各エンティティが持つべき具体的な情報（例: 顧客ID、顧客名、住所）を定義します。
4. リレーションシップを構築する: エンティティ間の関連性（例: 顧客は複数の注文を行う）を定義します。
5. 多重度を決定する: エンティティ間の数量関係（1対1、1対多、多対多）を定義し、図に表現します。
6. ツールを使って図を作成する: 作成した内容を、専用の作図ツール（例: Gliffy、Miro）を使って可視化します。
```


### 中間テーブル

#### What: 中間テーブルとは

データベースにおいて「多対多」の関係にある複数のテーブルを結びつけるために利用される特別なテーブルのこと

2つのテーブルの主キー（Primary Key）を外部キー（Foreign Key）として持ちます！
それぞれのテーブルのレコードの組み合わせを記録するテーブルで関連テーブル、結合テーブル、ジャンクションテーブルなどと呼ばれることもあります。

**例：**  
ある大学のデータベースで、「学生」と「コース」の多対多の関係を考えます。 

- 1人の学生は、複数のコースを履修できます。
- 1つのコースには、複数の学生が参加します。

この関係を直接表現することはできないため、「履修（Enrollment）」という中間テーブルを作成し、どの学生がどのコースを履修しているかを管理します。

|**students**|
|---|
|`student_id` (PK)|
|name|

|**courses**|
|---|
|`course_id` (PK)|
|name|

|**enrollments** (中間テーブル)|
|---|
|`student_id` (FK)|
|`course_id` (FK)|
|date_enrolled|

#### Why: なぜ中間テーブルが必要か

中間テーブルが必要となる主な理由は、データベースの設計原則である正規化を遵守するためです。 

- **多対多の関係を解消する**
    - リレーショナルデータベースでは、1つのセルに複数の値を格納することは原則としてできません。
      
    - 中間テーブルがない場合、「学生」テーブルに「履修コース」の列を追加すると、各学生が履修するすべてのコースをカンマ区切りなどで1つのセルにまとめることになり、データの不整合や検索の複雑さを招きます。
      
    - 中間テーブルを利用することで、この複雑な関係をシンプルに表現できます。
      
- **データの冗長性を排除する**
    - 中間テーブルを使用しないと、関連する情報を複数のテーブルで重複して持つことになり、データの整合性を維持するのが困難になります。
      
    - 中間テーブルは、関連するデータのみを格納することで、データの冗長性を最小限に抑えます。
      
- **関連情報を持たせる**
    - 単に2つのテーブルを紐づけるだけでなく、その関係性に関する追加情報を中間テーブルに持たせることができます。
      
    - 上記の例では、「履修日（`date_enrolled`）」を中間テーブルに持たせることで、「いつ履修が開始されたか」という情報を管理できます。 


#### How: 中間テーブルの作成方法

中間テーブルは、通常、以下の手順で作成します。

1. **多対多の関係にある2つのテーブルを特定する**
    - どのテーブルとどのテーブルの関係を整理する必要があるかを確認します（例：「`students`」と「`courses`」）。
      
2. **中間テーブルを設計する**
    - 中間テーブルには、関連付けたい2つのテーブルの主キーを外部キーとして格納する列を最低限設けます。
      
    - テーブル名は、関連する2つのテーブルの名前を組み合わせたものにすることが一般的です（例：`students_courses`や`enrollments`）。
      
    - 必要に応じて、関連付けに関する追加情報を格納する列（例：`date_enrolled`）を追加します。
      
3. **SQLでテーブルを作成する**
    - 以下のSQLは、先ほどの大学の例で`enrollments`テーブルを作成する例です。
    
    
    ```sql
    CREATE TABLE enrollments (
      id INT PRIMARY KEY AUTO_INCREMENT,  -- 独自の主キー
      student_id INT,
      course_id INT,
      date_enrolled DATE,
      FOREIGN KEY (student_id) REFERENCES students(student_id),
      FOREIGN KEY (course_id) REFERENCES courses(course_id)
    );
    ```
    
    コードは注意してご使用ください。
    
4. **データを挿入する**
    
    - 中間テーブルに、関連付けたいレコードのIDを挿入します。
    
    
    ```sql
    INSERT INTO enrollments (student_id, course_id, date_enrolled)
    VALUES (1, 101, '2025-10-13');  -- student_idが1の学生がcourse_idが101のコースを履修
    ```
    
    コードは注意してご使用ください。
    
5. **データを操作する**
    
    - 中間テーブルを利用して、関連データの検索、更新、削除を行います。
    
    ```sql
    -- 特定の学生が履修しているコースを検索する
    SELECT c.name
    FROM courses AS c
    JOIN enrollments AS e ON c.course_id = e.course_id
    WHERE e.student_id = 1;
    ```
    
    コードは注意してご使用ください。


---
#### SQL 

検索結果を加工するキーワードは以下の通りでです

| DISTINCT       | 検索結果の重複行を除外する           |
| -------------- | ----------------------- |
| ORDER BY       | 検索結果の順序を並び替える           |
| OFFSET - FETCH | 検索結果から件数を限定して取得する       |
| UNION          | 検索結果に他の検索結果を足し合わせる      |
| EXCEPT         | 検索結果から他の検索結果を差し引く       |
| INTEGERECT     | 検索結果と他の検索結果で重複する部分を取得する |
|                |                         |


---
---
## 学んだこと

- ER図について
- 中間テーブルについて
- SQLの検索結果で加工するときに使うキーワード


---
---
## 教材

- paiza 標準入力
- スッキリわかるSQL入門


---
---
##### ⏳ 学習時間: 6.5時間  
##### 🌱 コミット数: ２コミット