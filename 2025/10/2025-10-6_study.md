#daily

# 今日取り組んだタスク

- [ ] 基礎STEP 総復習
- [ ] Web技術の基本
- [ ] Railsガイド


---
---


# 学習内容
## Ruby / Rails

### [[オブジェクト_リレーショナルマッピング（ORM）]]

説明：
データベースとオブジェクト指向言語の間で データの変換や関連付けを自動化する機能のこと

ORMは、データベースのテーブルやレコードをオブジェクトとして表現したり
逆に、オブジェクトをデータベースのテーブルやレコードに変換したりと
プログラミング言語のオブジェクトとデータベースの間で直接的な相互作用を可能にする。

背景：

ORMの主な機能

マッピング機能
1. ORMの最も基本的な機能の1つでデータベース構造とプログラムのオブジェクト構造を対応づける
   - DBのテーブル　<=>　モデル（クラス）
   - テーブルのレコード　<=>　オブジェクト
      - テーブルの1つのレコードとクラスの1つのインスタンス（オブジェクト）を対応付け
- カラム　<=>　属性
   - レコードの各カラムとオブジェクトの属性（プロパティ）を対応付け
2. クエリーインターフェイス機能
3. 永続化機能
4. 関連付け管理機能

マッピング機能
ORMの最も基本的な機能の1つでデータベース構造とプログラムのオブジェクト構造を対応づける

- DBのテーブル　<=>　モデル（クラス）
- テーブルのレコード　<=>　オブジェクト
	- テーブルの1つのレコードとクラスの1つのインスタンス（オブジェクト）を対応付け
	  
- カラム　<=>　属性
	- レコードの各カラムとオブジェクトの属性（プロパティ）を対応付け
	
クエリーインターフェイス機能
SQLを直接記述する代わりに、オブジェクト指向のメソッドを呼び出すことで
データ操作を可能にする（例：CRUDなど）

永続化機能
プログラムで変更されたオブジェクトの状態をDBに反映（永続化）させる

- SQL自動生成
  オブジェクトに対して、`save`や`update`、`delete`といった操作が、対応する`INSERT`、`UPDATE`、`DELETE`といったSQLに
  自動変換して実行される

関連付け管理機能
オブジェクト間の関連（リレーション）を管理し、関連するデータを簡単に取得できるようにしている

例：
ユーザーと複数の記事の関連付けがあるとすると
ユーザーオブジェクトからそのユーザーが書いた記事のリストを取得することができる



### [[O/Rマッピング（Object-Relational Mapping）]]

説明：
オブジェクト指向プログラミング言語とリレーショナルデータベースの間で
データのマッピングを行うプロセスやパターンのこと


### [[O/Rマッパー（Object-Relational Mapper）]]

説明：**ORMを実現する具体的なツールやフレームワークのこと

|O/Rマッパー|プラットフォーム|
|---|---|
|Hibernate|Java|
|Entity Framework|.NET|
|Django ORM|Python|
|Sequelize|JavaScript/Node.js|
|Ruby on Rails ActiveRecord|Ruby on Rails|
|SQLAlchemy|Python|

### [[ActiveRecord]]

説明：Active Recordは  、Ruby on Railsフレームワークの一部として提供されるO/Rマッパー



### [[where]]

説明：
条件に当てはまるレコードを全て取得
特定のレコードだけ取得したり、検索機能を実装したりするときに使うメソッドである

```ruby
### 使い方
モデル.where(条件..)
```

具体例：
```ruby
# ageカラムに20が入っているレコードを全て取得
@users = User.where(age: 20)

  User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE `users`.`age` = 20
=> [#<User:0x007fd316ec6710
  id: 1,
  name: "ぴかこ",
  age: 20,
  height: 170,
  weight: 60,>]

```


whereメソッドの記述方法
```ruby
モデル名.where(カラム名: 条件)

# nameカラムから「ぴっか」という文字が入っているレコードを全て取得
User.where(name: "ぴっか")

# 発行されるSQL
User Load (0.6ms)  SELECT `users`.* FROM `users` WHERE `users`.`name` = 'ぴっか'
=> [#<User:0x007fd316cdeee8
  id: 3,
  name: "ぴっか",
  age: 30,
  height: 155,
  weight: 46>]
```


文字列指定の方法
```ruby
モデル名.where("カラム名 = 条件")

# nameカラムから「ぴっか」という文字が入っているレコードを全て取得
User.where("name = 'ぴっか'")

# 発行されるSQL
User Load (17.2ms)  SELECT `users`.* FROM `users` WHERE (name = 'ぴっか')
=> [#<User:0x007fd313623f70
  id: 3,
  name: "ぴっか",
  age: 30,
  height: 155,
  weight: 46>]
```

実際には、1つの条件で検索するときに`where(カラム名: "条件")`のようにシンボル指定で定義
なぜなら、==SQLインジェクション==というセキュリティ上の脆弱性を防ぐため


### [[SQLインジェクション]]

説明：
SQLを呼び出すときに
セキュリティ上の不備を利用して、DBのデータを不正に操作する攻撃方法のこと



例えば下記のようなコードがあったとします。
```sql
/*指定したidのユーザーのレコードを取得（コントローラー）*/
id = params[:id]
User.where("id = #{id}")

/*発行されるSQL（ターミナル）*/
SELECT `users`.* FROM `users` WHERE (id = 1)
```

これは、ユーザーidが`1`のユーザーのレコードを取得できます。



もしこの`1`の部分に`1 OR 1 = 1`という値が入ってしまうとどうなるでしょうか？
```sql
/*id = '1 OR 1 = 1'が代入 （コントローラー）*/
id = '1 OR 1 = 1'
User.where("id = #{id}")

/*発行されるSQL（ターミナル）*/
SELECT `users`.* FROM `users` WHERE (id = 1 OR 1 = 1)
```

#### 解説
背景として、SQLではWHEREに`true`が渡ると全てのレコードを取得する

id = '1 OR 1 = 1'において
1 = 1 がtrueと判断されるから、全てのレコードを取得できてしまう

これにより、全てのユーザーのデータが取得されてしまうから、セキュリティ上大問題である

解決策として
ハッシュ形式で記述しておけば、このようなことは起こらない
```sql
/*発行されるSQL(ターミナル)*/
User.where(id: id)

/*発行されるSQL*/
SELECT `users`.* FROM `users` WHERE `users`.`id` = 1
```


### [[find]]

#### 説明：
引数で指定したidのレコードを1件だけ取得するメソッドのこと
指定したIDの中に存在しないIDが1つでもあると例外が発生

```ruby
### 使い方
モデル.find(件数..)
```

#### 具体例：
IDを指定してレコードを取得
```ruby
Person.find(1)
```

複数IDを指定
```ruby
Person.find(1, 2, 6)
```

配列で指定
```ruby
Person.find([7, 17])
```


#### どのような時に使うのか

直接取得したいテーブルは指定できるので
- レコードを編集、削除したい場合
- レコードの詳細を表示させたい場合　　がある


補足
どこでテーブルを指定しているのか？

A：
**モデルクラス（`User`）がテーブルを決めている**
Rails の規約によりクラス名 `User` → テーブル名 `users` にマッピングされる


### [[first]]

説明：テーブルの先頭のレコードを取得するメソッド

#### 使い方
```ruby
モデル.first(件数=nil)

# 失敗したら例外発生
モデル.first!(件数=nil)
```

#### 補足
- 何も引数を渡さなかった場合 → `limit` は `nil` になる
	- 先頭の1件を取得
- 引数を渡した場合 → 渡した値が `limit` に代入される


---


### Web技術の基本

#### HTTPヘッダー

説明：
HTTPリクエストやHTTPレスポンスに付随するメタ情報（ヘッダー群）のこと。
通信の制御やコンテンツの種類、キャッシュ、認証などを伝えるために使われる。

#### HTTPヘッダーフィールド

説明：HTTPヘッダーを構成する個々の項目（フィールド）のこと。形式は `フィールド名: フィールド値`。

構成：
```
date: Mon, 01 Jan 2024 00:00:00 GMT
Content-Type: application/json; charset=utf-8
フィールド名：    フィールド値
```

##### ヘッダーの分類

一般ヘッダーフィールド
説明：
リクエストとレスポンスの両方で使えるヘッダーフィールドで
HTTPメッセージ全体（メッセージの転送やキャッシュ、日時など）に関する情報を表す。

リクエストヘッダーフィールド
説明：クライアント（ブラウザ等）からサーバへ送られるヘッダーフィールド

レスポンスヘッダーフィールド
説明：サーバからクライアントへ返されるヘッダーフィールド

エンティティヘッダーフィールド
説明：メッセージボディ（エンティティ）に関する情報を示すヘッダーフィールド



---
---


## 学んだこと

- オブジェクト_リレーショナルマッピング（ORM）について
	- O/Rマッピング（Object-Relational Mapping）
	- O/Rマッパー（Object-Relational Mapper）
- SQLインジェクションについて
- ActiveRecordをちょっとだけ学習
- first、find、whereメソッドについて


---
---


## 教材

- web技術の基本
- Railsガイド
-  RUNTEQカリキュラム：基礎STEP 総復習



---
---


##### ⏳ 学習時間: 4.9時間  
##### 🌱 コミット数: 1コミット